<?php if ( ! defined('BASEPATH')) exit('No direct script access allowed');

class Posters extends CI_Controller {

    
       
       function __construct()
	{
		parent::__construct();
		$this->load->helper(array('form','url','tesseract','saaspose','opencalais'));
	}

	function index()
	{
		$this->load->view('post', array('error' => ''));
	}

	function do_upload()
	{
		$config['upload_path'] = './uploads/';
		$config['allowed_types'] = 'gif|jpg|png|pdf';
		$config['max_size']	= '2000000';
		//$config['max_width']  = '1024';
		//$config['max_height']  = '768';

		$this->load->library('upload', $config);
		$field_name = "docurl";


		if (!$this->upload->do_upload($field_name))
		{
			$error = array('error' => $this->upload->display_errors());
			$data = array('page_title'     => 'Test the document!');
			$this->load->view('header',$data);
			$this->load->view('post', $error);
			$this->load->view('footer');
		}
		else
		{
			$upload_data = $this->upload->data();
			$content = array('content' =>  $this->do_process($upload_data), 'filename' => $upload_data['file_name']);
			$data = array('page_title'     => 'Extract text from document!');

			$this->load->view('header',$data);
			$this->load->view('test',$content);
			$this->load->view('footer');
			//	$this->load->view('upload_success', $data);
		}
	}
	
	function do_process($filedata)
	{
		$url = 'http://www.worldweatheronline.com/feed/weather.ashx?q=schruns,austria&format=json&num_of_days=5&key=8f2d1ea151085304102710%22';
		$content = file_get_contents($url);
		$json = json_decode($content, true);
		
		foreach($json['data']['weather'] as $item) {
		    print $item['date'];
		    print ' - ';
		    print $item['weatherDesc'][0]['value'];
		    print ' - ';
		    print '<img src="' . $item['weatherIconUrl'][0]['value'] . '" border="0" alt="" />';
		    print '<br>';
		}
		exit;
	}
	
	function entity()
	{
		
		$context = $_POST['content'];		
		//echo $context;exit;
		
		$apikey = "sp3u4wvyqbpx34zauxqp7qr2";
		$oc = new OpenCalais($apikey);
		
		$entities = $oc->getEntities($context);
		$entity_info="";
		foreach ($entities as $type => $values) {
		
			$entity_info.= "<b>" . $type . "</b>";
			$entity_info.= "<ul>";
					
			foreach ($values as $entity) {
				$entity_info.= "<li>" . $entity . "</li>";
			}
		
			$entity_info.= "</ul>";
		
		}
				
		$content=array('entities' => $entity_info,'error' => '');
		$data = array('page_title'     => 'Entity Extraction');


		$this->load->view('header',$data);
		$this->load->view('entity',$content);
		$this->load->view('footer');
	}
			
}

/* End of file posts.php */
/* Location: ./application/controllers/posts.php */